{% extends 'base.html' %}

{% block content %}

<form action="{% url 'confirmar_reserva' %}" action="POST"> {% csrf_token %}
    <table class="table table-striped table-hover table-bordered mt-4">
        <thead class="thead-dark">
            <th colspan="2">
                <span style="float:right;">Fecha: {{ fecha_actual }}</span>
                Datos del Cliente y Detalles del Viaje
            </th>
        </thead>
        <tbody>
            <tr>
                <td colspan="2">
                    <label for="datosCliente"><strong>Cliente: </strong>DATOS DEL CLIENTE AQUI</label>
                    <span style="float:right;"><strong>Viaje: </strong>{{ ruta.origen }} - {{ ruta.destino }} </span>
                    <br>
                    <span style="float:right;"><strong>Tren: </strong>{{ ruta.tren.nombre }}</span>
                </td>
            </tr>

        </tbody>
    </table>

    <div class="row-40">
        <!-- 
        <div>
            <p>IMAGEN AQUI</p>
            <img src="imagen_asientos.jpg" alt="Asientos del tren">
        </div>
        -->
        <div class="text-center">
            <strong>Asientos disponibles: </strong>
            <br>
            <div class="container mt-2">
                <!-- <h2 class="text-center mb-4">Reserva de Asientos</h2> -->

                <div class="seat-map mb-3" id="seatMap">
                    <!-- Asientos se generarán dinámicamente -->
                </div>
                <div class="mt-3">
                    <h5>Información:</h5>
                    <ul style="list-style-type: none;">
                        <li><span class="badge bg-success">Disponible</span></li>
                        <li><span class="badge bg-danger">Reservado</span></li>
                        <li><span class="badge bg-warning text-dark">Seleccionado</span></li>
                    </ul>
                </div>
                <div class="d-flex justify-content-end mt-3" style="width: auto;">
                    <div class="form-group mr-2" style="min-width: 150px;">
                        <button type="submit" id="reserveSeatsBtn" class="btn btn-dark w-100"
                            style="background-color: #000000; border-color: #000000; min-width: 150px;"
                            onmouseover="this.style.transform='scale(1.01)'; this.style.backgroundColor='#2c2c2c';"
                            onmouseout="this.style.transform='scale(1)'; this.style.backgroundColor='#000000';">
                            <i class="fas fa-save"></i> Reservar asientos
                        </button>
                    </div>
                    <div class="form-group" id="cancelSeatsBtn" style="min-width: 150px;">
                        <a href="javascript:history.back()" class="btn btn-dark w-100"
                            style="background-color: #000000; border-color: #000000; min-width: 150px;"
                            onmouseover="this.style.transform='scale(1.01)'; this.style.backgroundColor='#2c2c2c';"
                            onmouseout="this.style.transform='scale(1)'; this.style.backgroundColor='#000000';">
                            <i class="fas fa-save"></i> Cancelar
                        </a>
                    </div>
                </div>
                
            </div>

            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

            <script>
                const totalSeats = {{ asientos| safe }};  // Convertir la lista de asientos de Django a una lista de JavaScript
                const seatMapContainer = document.getElementById('seatMap');
                let reservedSeats = JSON.parse(localStorage.getItem('reservedSeats')) || [];

                function generateSeatMap() {
                    for (let i = 0; i < totalSeats.length; i++) {
                        const seat = document.createElement('div');
                        seat.classList.add('seat');
                        const seatNumber = totalSeats[i];

                        if (reservedSeats.includes(seatNumber)) {
                            seat.classList.add('reserved');
                        } else {
                            seat.classList.add('available');
                            seat.addEventListener('click', function () {
                                toggleSeatSelection(seat, seatNumber);
                            });
                        }

                        seat.textContent = seatNumber;
                        seatMapContainer.appendChild(seat);
                    }
                }

                function toggleSeatSelection(seat, seatNumber) {
                    if (seat.classList.contains('selected')) {
                        seat.classList.remove('selected');
                    } else {
                        seat.classList.add('selected');
                    }
                }

                document.getElementById('reserveSeatsBtn').addEventListener('click', function () {
                    const selectedSeats = Array.from(document.getElementsByClassName('selected'));
                    const seatNumbers = selectedSeats.map(seat => seat.textContent);

                    // Agregar asientos seleccionados a los reservados
                    reservedSeats = reservedSeats.concat(seatNumbers);
                    localStorage.setItem('reservedSeats', JSON.stringify(reservedSeats));

                    // Actualizar la vista de los asientos
                    selectedSeats.forEach(seat => {
                        seat.classList.remove('selected');
                        seat.classList.add('reserved');
                        seat.removeEventListener('click', toggleSeatSelection);
                    });
                });

                generateSeatMap();
            </script>
        </div>
    </div>


</form>

{% endblock %}